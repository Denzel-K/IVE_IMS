âœ… Migrating from a Local MySQL Server to a Bundled MySQL Folder (Standalone)

You can continue developing with a locally installed MySQL server and later package MySQL inside your app folder when moving to production. The migration is easy if planned well.
ğŸ”¹ 1. How Easy Is the Migration?

âœ… Very easy! The only things that will change are:

    Database connection settings â†’ Update db.js to point to the bundled MySQL instance.
    MySQL initialization â†’ Set up a MySQL instance inside the app folder.
    Data migration â†’ Export your local database and import it into the bundled MySQL.

ğŸ”¹ 2. Current Development Setup (Using Installed MySQL)

During development, you are likely using this type of connection in db.js:

const mysql = require("mysql2");

const db = mysql.createConnection({
  host: "localhost",
  user: "root",
  password: "",
  database: "ive_ims",
  port: 3306,
});

db.connect((err) => {
  if (err) console.error("âŒ MySQL Connection Failed:", err);
  else console.log("âœ… Connected to Local MySQL Server.");
});

module.exports = db;

ğŸ”¹ 3. Switching to a Bundled MySQL Instance

Once you package your app, the MySQL database must run from the app folder.
âœ… Step 1: Add MySQL to Your App Folder

Download a portable version of MySQL:

    Windows: Download MySQL ZIP
    Linux/macOS: Use MySQL binaries (no installer required).

Extract it into your app folder:

IVE_IMS/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ mysql/    â† Contains MySQL binaries & data folder
â”‚   â”œâ”€â”€ server.js
â”œâ”€â”€ renderer/
â”œâ”€â”€ main.js

âœ… Step 2: Modify db.js to Detect the Bundled MySQL

Update db.js to first try local MySQL, and if unavailabel, start the bundled MySQL instance:

const mysql = require("mysql2");
const path = require("path");
const { exec } = require("child_process");

const localDBConfig = {
  host: "localhost",
  user: "root",
  password: "",
  database: "ive_ims",
  port: 3306,
};

const bundledDBConfig = {
  host: "localhost",
  user: "root",
  password: "",
  database: "ive_ims",
  port: 3307, // Use a different port to avoid conflicts
  socketPath: path.join(__dirname, "mysql/mysql.sock"),
};

let db;

// Try connecting to the local MySQL server first
db = mysql.createConnection(localDBConfig);
db.connect((err) => {
  if (err) {
    console.warn("âš ï¸ Local MySQL not found. Starting bundled MySQL...");

    // Start the bundled MySQL instance
    exec(
      `"${path.join(__dirname, "mysql/bin/mysqld")}" --defaults-file=${path.join(
        __dirname,
        "mysql/my.ini"
      )}`,
      (err, stdout, stderr) => {
        if (err) {
          console.error("âŒ Failed to start bundled MySQL:", stderr);
        } else {
          console.log("âœ… Bundled MySQL started.");

          // Connect to the bundled MySQL after starting it
          db = mysql.createConnection(bundledDBConfig);
          db.connect((err) => {
            if (err) console.error("âŒ Bundled MySQL Connection Failed:", err);
            else console.log("âœ… Connected to Bundled MySQL.");
          });
        }
      }
    );
  } else {
    console.log("âœ… Connected to Local MySQL Server.");
  }
});

module.exports = db;

âœ… Step 3: Initialize the Bundled MySQL Database

    Navigate to backend/mysql/bin/ inside your app folder.

    Run this command to initialize the MySQL data directory:

mysqld --initialize-insecure

(This creates an empty MySQL database.)

Create a configuration file backend/mysql/my.ini:

    [mysqld]
    port=3307
    datadir=./data
    socket=./mysql.sock

âœ… Step 4: Migrate Your Data from Local MySQL

Once you're done developing and want to move your data to the bundled MySQL, follow these steps:
ğŸ“Œ Export Data from Local MySQL

Run this command on your local MySQL:

mysqldump -u root -p ive_ims > database_backup.sql

(This exports all your tables into a SQL file.)
ğŸ“Œ Import Data into Bundled MySQL

    Copy database_backup.sql to backend/mysql/ inside your app folder.
    Run this command to import it into your bundled MySQL:

    mysql -u root -p ive_ims < database_backup.sql

ğŸ”¹ 4. Running MySQL in Production

Once you package the app with Electron, your bundled MySQL must start before the app runs.

Modify main.js to start MySQL first before launching the app:

const { spawn } = require("child_process");
const path = require("path");

function startMySQL() {
  const mysqlPath = path.join(__dirname, "backend/mysql/bin/mysqld");
  
  const mysqlProcess = spawn(mysqlPath, ["--defaults-file=my.ini"], {
    cwd: path.join(__dirname, "backend/mysql"),
    detached: true,
    stdio: "ignore",
  });

  mysqlProcess.unref();
  console.log("âœ… MySQL server started locally.");
}

app.whenReady().then(() => {
  startMySQL(); // Start MySQL before launching Electron
  createMainWindow();
});

ğŸ”¹ 5. Packaging the App with MySQL

After setting up MySQL, package the app using:

npx electron-packager . IVE_IMS --platform=win32 --arch=x64 --out=release-build --overwrite

This will generate an executable .exe file that contains both MySQL and your app.
ğŸ¯ Summary

âœ… During development, you use a locally installed MySQL.
âœ… For production, you bundle MySQL inside the app and start it automatically.
âœ… Database connection (db.js) detects whether local or bundled MySQL is availabel.
âœ… Migrate data by exporting (mysqldump) and importing into the bundled MySQL.
âœ… Electron automatically starts the bundled MySQL before running the app.
ğŸš€ How Easy Is the Migration?

âœ… Very easy! Since we designed the system to detect MySQL automatically, no code changes are neededâ€”just package MySQL inside your app!
ğŸ’¡ Next Steps

1ï¸âƒ£ Continue development with local MySQL.
2ï¸âƒ£ Set up bundled MySQL inside your app folder.
3ï¸âƒ£ Modify db.js to check both local and bundled MySQL.
4ï¸âƒ£ Migrate data using mysqldump once development is complete.
5ï¸âƒ£ Package the final app with Electron and test!
